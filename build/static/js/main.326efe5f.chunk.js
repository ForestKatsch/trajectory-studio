(this["webpackJsonptrajectory-studio"]=this["webpackJsonptrajectory-studio"]||[]).push([[0],{20:function(e,t){e.exports='<svg xmlns:dc="http://purl.org/dc/elements/1.1/" xmlns:cc="http://creativecommons.org/ns#" xmlns:rdf="http://www.w3.org/1999/02/22-rdf-syntax-ns#" xmlns:svg="http://www.w3.org/2000/svg" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xmlns:sodipodi="http://sodipodi.sourceforge.net/DTD/sodipodi-0.dtd" xmlns:inkscape="http://www.inkscape.org/namespaces/inkscape" sodipodi:docname="Circular.svg" inkscape:version="1.0 (4035a4fb49, 2020-05-01)" id="svg8" version="1.1" viewBox="0 0 32 32"><defs id="defs2"><linearGradient id="linearGradient913" inkscape:collect="always"><stop id="stop909" offset="0" style="stop-color:#000000;stop-opacity:1;"></stop><stop id="stop911" offset="1" style="stop-color:#000000;stop-opacity:0;"></stop></linearGradient><linearGradient gradientTransform="matrix(1.0588235,0,0,1.0588235,-0.94117647,-0.94117647)" gradientUnits="userSpaceOnUse" y2="10" x2="12" y1="16" x1="23" id="linearGradient915" xlink:href="#linearGradient913" inkscape:collect="always"></linearGradient></defs><sodipodi:namedview inkscape:snap-nodes="true" inkscape:bbox-nodes="false" inkscape:snap-bbox="true" inkscape:snap-global="true" inkscape:snap-center="true" inkscape:snap-smooth-nodes="true" units="px" inkscape:window-maximized="0" inkscape:window-y="20" inkscape:window-x="0" inkscape:window-height="1399" inkscape:window-width="2560" showgrid="true" inkscape:document-rotation="0" inkscape:current-layer="layer1" inkscape:document-units="px" inkscape:cy="11.686131" inkscape:cx="10.895753" inkscape:zoom="31.678384" inkscape:pageshadow="2" inkscape:pageopacity="0.0" borderopacity="1.0" bordercolor="#666666" pagecolor="#ffffff" id="base"><inkscape:grid id="grid12" type="xygrid"></inkscape></sodipodi:namedview><metadata id="metadata5"><rdf:RDF><cc:Work rdf:about><dc:format>image/svg+xml</dc:format><dc:type rdf:resource="http://purl.org/dc/dcmitype/StillImage"></dc><dc:title></dc:title></cc:Work></rdf:RDF></metadata><g id="layer1" inkscape:groupmode="layer" inkscape:label="Layer 1"><path transform="rotate(-135)" sodipodi:open="true" id="path921" style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:0.2;paint-order:markers fill stroke" sodipodi:type="arc" sodipodi:cx="-22.627417" sodipodi:cy="1.6744707e-07" sodipodi:rx="10" sodipodi:ry="10" sodipodi:start="1.8325957" sodipodi:end="6.0213859" sodipodi:arc-type="arc" d="m -25.215607,9.6592585 a 10,10 0 0 1 -7.373757,-10.5308156 10,10 0 0 1 9.09039,-9.0903897 10,10 0 0 1 10.530816,7.3737563" inkscape:transform-center-y="2.4999997"></path><path transform="rotate(-135)" id="path1119" style="fill:none;fill-opacity:1;stroke:#000000;stroke-width:3;stroke-miterlimit:4;stroke-dasharray:none;stroke-opacity:0.8;paint-order:markers fill stroke" sodipodi:type="arc" sodipodi:cx="-22.627417" sodipodi:cy="-3.1359626e-09" sodipodi:rx="10" sodipodi:ry="10" sodipodi:start="0" sodipodi:end="1.5707963" sodipodi:arc-type="arc" d="m -12.627417,0 a 10,10 0 0 1 -10,10" inkscape:transform-center-y="-8.5355342" sodipodi:open="true"></path></g></svg>'},25:function(e,t,a){e.exports=a(40)},30:function(e,t,a){},31:function(e,t,a){},36:function(e,t,a){},37:function(e,t,a){},38:function(e,t,a){},39:function(e,t,a){},40:function(e,t,a){"use strict";a.r(t);var r=a(1),n=a.n(r),i=a(17),s=a.n(i);a(30),a(31);for(var o=function(){return n.a.createElement("header",{className:"PageHeader App--theme-light"},n.a.createElement("h1",null,"Orrery"))},c=a(13),l=a(3),h=a(4),u=a(6),d=a(8),m=a(7),f=a(18),p=a.n(f),v=a(0),_=a.n(v),g=a(5),y=a(11),b=a(9),x=a(2),E=a(15),w=a.n(E),T=a(10),k=a(19),C=0,S=1,P=2,A=3,O=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){var r;return Object(l.a)(this,a),(r=t.call(this)).name=e,r.state=C,r.can_move_backwards=!1,r}return Object(h.a)(a,[{key:"setState",value:function(e){this.state!==e&&(_.a.info("Asset '".concat(this.name,"' state is moving from '").concat(this.state,"' to '").concat(e,"'")),this.isDoneLoading()&&!this.can_move_backwards&&_.a.warn("Asset '".concat(this.name,"' state is moving from '").concat(this.state,"' to '").concat(e,"', but it's already loaded.")),this.state=e,this.emit("statechange",{previous:this.state,state:e,asset:this}))}},{key:"isLoaded",value:function(){return this.state===P}},{key:"isLoading",value:function(){return this.state===S}},{key:"isDoneLoading",value:function(){return this.isLoaded()||this.state===A}},{key:"getCombinedState",value:function(e){var t=P;if(0===e.length)return t;var a,r=Object(T.a)(e);try{for(r.s();!(a=r.n()).done;){var n=a.value;n.state!==A&&(t=Math.min(t,n.state))}}catch(i){r.e(i)}finally{r.f()}return t}}]),a}(a.n(k).a),M=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){var r;return Object(l.a)(this,a),(r=t.call(this,e)).assets={},r.can_move_backwards=!0,r.handleAssetStateChange=r.handleAssetStateChange.bind(Object(u.a)(r)),r}return Object(h.a)(a,[{key:"addAsset",value:function(e,t){this.assets[e]=t,t.on("statechange",this.handleAssetStateChange),this.updateState()}},{key:"getAsset",value:function(e){return this.assets[e]}},{key:"hasAsset",value:function(e){return e in this.assets}},{key:"getAllAssets",value:function(){return this.assets}},{key:"handleAssetStateChange",value:function(e){this.emit("childstatechange",{previous:e.previous,state:e.state,asset:e.asset,loader:this}),this.updateState()}},{key:"updateState",value:function(){this.setState(this.getCombinedState(Object.values(this.assets)))}}]),a}(O),R=a(21),U={BOOL:35670,BYTE:5120,UNSIGNED_BYTE:5121,SHORT:5122,UNSIGNED_SHORT:5123,INT:5124,UNSIGNED_INT:5125,FLOAT:5126,FVEC2:35664,FVEC3:35665,FVEC4:35666,IVEC2:35667,IVEC3:35668,IVEC4:35669,BVEC2:35671,BVEC3:35672,BVEC4:35673,MAT2:35674,MAT3:35675,MAT4:35676,TEXTURE:5890,TEXTURE_2D:3553,TEXTURE_CUBE_MAP:34067,SAMPLER_2D:35678,SAMPLER_CUBE:35680},D={},j=0,I=Object.keys(U);j<I.length;j++){var N=I[j];D[U[N]]=N}for(var L={},z=0,V=Object.keys(U);z<V.length;z++){var B=V[z];L[U[B]]=B}L[U.SAMPLER_2D]=U.TEXTURE_2D,L[U.SAMPLER_CUBE]=U.TEXTURE_CUBE_MAP;var W=function(){function e(t){Object(l.a)(this,e),this.dirty_function=t,this.uniforms={}}return Object(h.a)(e,[{key:"set",value:function(e,t){if(e in this.uniforms){if(this.uniforms[e]===t)return;if(typeof this.uniforms[e]===typeof[]&&this.uniforms[e].length===t.length&&this.uniforms[e].every((function(e,a){return e===t[a]})))return}this.uniforms[e]=typeof t===typeof[]?Object(R.a)(t):t,this.dirty_function()}},{key:"get",value:function(){return this.uniforms}}]),e}(),X=function(){function e(t,a,r,n){Object(l.a)(this,e),this.renderer=t,this.name=a,this.vertex_source=r,this.fragment_source=n,this.vertex=null,this.fragment=null,this.program=null,this.attributes={},this.uniforms={}}return Object(h.a)(e,[{key:"compileShader",value:function(e,t){var a=this.renderer.context,r=a.createShader(e);if(a.shaderSource(r,t),a.compileShader(r),!a.getShaderParameter(r,a.COMPILE_STATUS))throw _.a.error("Error while compiling WebGL shader '".concat(this.name,"'"),a.getShaderInfoLog(r),t),a.deleteShader(r),new Error("webgl-shader-compile");return r}},{key:"init",value:function(){var e=this.renderer.context;if(this.vertex=this.compileShader(e.VERTEX_SHADER,this.vertex_source),this.fragment=this.compileShader(e.FRAGMENT_SHADER,this.fragment_source),this.program=e.createProgram(),e.attachShader(this.program,this.vertex),e.attachShader(this.program,this.fragment),e.linkProgram(this.program),!e.getProgramParameter(this.program,e.LINK_STATUS))throw _.a.error("Error while linking WebGL shader '".concat(this.name,"'"),e.getProgramInfoLog(this.program)),this.program=null,new Error("webgl-shader-link");this.fetchShaderParameters()}},{key:"deinit",value:function(){var e=this.renderer.context;null!==e&&(e.deleteShader(this.vertex),e.deleteShader(this.fragment),e.deleteProgram(this.program)),this.program=null}},{key:"fetchShaderParameters",value:function(){for(var e=this.renderer.context,t=e.getProgramParameter(this.program,e.ACTIVE_ATTRIBUTES),a=0;a<t;a++){var r=e.getActiveAttrib(this.program,a),n=L[r.type];this.attributes[r.name]={location:e.getAttribLocation(this.program,r.name),name:r.name,type:n}}for(var i=e.getProgramParameter(this.program,e.ACTIVE_UNIFORMS),s=0;s<i;s++){var o=e.getActiveUniform(this.program,s),c=L[o.type];this.uniforms[o.name]={location:e.getUniformLocation(this.program,o.name),name:o.name,type:c}}}},{key:"use",value:function(){var e=this.renderer.context;this.renderer.active.shader!==this&&(this.renderer.active.shader=this,e.useProgram(this.program))}},{key:"isReady",value:function(){return null!==this.program}},{key:"getAttributeLocation",value:function(e){return e in this.attributes?this.attributes[e].location:-1}},{key:"getUniformLocation",value:function(e){return e in this.uniforms?this.uniforms[e].location:-1}},{key:"detectUniformType",value:function(e,t,a){if(void 0!==a&&a!==U.AUTO)return a;if("number"===typeof t)a=t%1===t?U.INT:U.FLOAT;else if("string"===typeof t)a=U.TEXTURE;else{if(typeof t!==typeof[])return _.a.warn("Cannot auto-detect type of uniform '".concat(e,"', ignoring"),t),null;if(2===t.length)a=U.FVEC2;else if(3===t.length)a=U.FVEC3;else if(4===t.length)a=U.FVEC4;else if(9===t.length)a=U.MAT3;else{if(16!==t.length)return void _.a.warn("Cannot auto-detect type of uniform '".concat(e,"' (on shader '").concat(this.name,"') array with ").concat(t.length," elements, ignoring"),t);a=U.MAT4}}return a}},{key:"setUniform",value:function(e,t,a){var r=this.renderer.context,n=this.getUniformLocation(e);if(!(n<0))switch(a){case U.INT:r.uniform1i(n,t);break;case U.FLOAT:r.uniform1f(n,t);break;case U.FVEC2:r.uniform2fv(n,t);break;case U.FVEC3:r.uniform3fv(n,t);break;case U.FVEC4:r.uniform4fv(n,t);break;case U.MAT3:r.uniformMatrix3fv(n,!1,t);break;case U.MAT4:r.uniformMatrix4fv(n,!1,t);break;case U.TEXTURE:_.a.warn("Cannot set texture uniform '".concat(e,"' in 'setUniform'. (See 'setTextureUniform.)"),t);break;default:_.a.warn("Cannot set uniform '".concat(e,"' with unknown type '").concat(a,"' ignoring"),t)}}},{key:"setTextureUniform",value:function(e,t,a){var r=this.renderer.context,n=this.getUniformLocation(e);r.activeTexture(r.TEXTURE0+a),r.bindTexture(t.type,t.texture),r.uniform1i(n,a)}},{key:"setUniforms",value:function(e){for(var t={},a=0,r=Object.keys(e);a<r.length;a++){var n=r[a];if(!n.startsWith("@")){var i=e[n],s=U.AUTO;typeof e[n]===typeof[]&&"string"===typeof e[n][0]&&(s=e[n][0],i=e[n][1]),(s=this.detectUniformType(n,i,s))!==U.TEXTURE?this.setUniform(n,i,s):t[n]={uniform_name:n,texture_name:i}}}this.setTextureUniforms(t)}},{key:"setTextureUniforms",value:function(e){for(var t=0,a=0,r=Object.keys(this.uniforms);a<r.length;a++){var n=r[a],i=this.uniforms[n].type;if(i===U.TEXTURE_2D||i===U.TEXTURE_CUBE_MAP){var s=null;if(i===U.TEXTURE_2D)s=this.renderer.getTexture("@fallback");else{if(i!==U.TEXTURE_CUBE_MAP){_.a.warn("Unexpected texture type '".concat(D[i],"' for uniform '").concat(n,"' in shader '").concat(this.name,"', ignoring"));continue}s=this.renderer.getTexture("@fallback-cube")}if(n in e){var o=this.renderer.getTexture(e[n].texture_name);o.type===i?s=o:null===o.type||o.name.startsWith("@")||_.a.warn("Texture '".concat(o.name,"' for uniform '").concat(n,"' on shader '").concat(this.name,"' is wrong texture type (should be '").concat(D[i],"', found '").concat(D[o.type],"'), using fallback"))}this.setTextureUniform(n,s,t++)}}}}]),e}();function F(e){for(var t=[],a=0;a<e.length;a++)"number"!==typeof e[a]?t.push.apply(t,F(e[a])):t.push(e[a]);return t}var G=function(){function e(t,a,r){Object(l.a)(this,e),this.renderer=t.renderer,this.mesh=t,this.name=a,this.type=r,this.data=[],this.buffer=null,this.attributes={}}return Object(h.a)(e,[{key:"addAttribute",value:function(e,t){var a=this.renderer.context;t=Object(g.a)({offset:0,size:3,type:a.FLOAT,normalized:!1,stride:0},t),this.attributes[e]=t}},{key:"apply",value:function(){var e=this.renderer.context;_.a.debug("Creating buffer '".concat(this.mesh.name,".").concat(this.name,"'...")),null===this.buffer&&(this.buffer=e.createBuffer()),this.bind(),e.bufferData(this.type,this.data,e.STATIC_DRAW)}},{key:"bind",value:function(){var e=this.renderer.context;this.renderer.active.buffer!==this&&(this.renderer.active.buffer=this,e.bindBuffer(this.type,this.buffer))}},{key:"attachShader",value:function(e){this.bind();for(var t=this.renderer.context,a=0,r=Object.keys(this.attributes);a<r.length;a++){var n=r[a],i=this.attributes[n],s=e.getAttributeLocation(n);-1!==s&&(t.enableVertexAttribArray(s),t.vertexAttribPointer(s,i.size,t.FLOAT,i.normalize,i.stride,i.offset))}}},{key:"isValid",value:function(){return null!==this.buffer}},{key:"deinit",value:function(){var e=this.renderer.context;null!==e&&e.deleteBuffer(this.buffer)}}]),e}(),H=function(){function e(t,a){Object(l.a)(this,e),this.renderer=t,this.name=a,this.buffers={},this.ready=!1,this.vertex_count=0}return Object(h.a)(e,[{key:"createBuffer",value:function(e,t){e in this.buffers&&(_.a.warn("Duplicate buffer '".concat(e,"' is being requested; deleting existing buffer.")),this.buffers[e].deinit());var a=new G(this,e,t);return this.buffers[e]=a,a}},{key:"createMesh",value:function(e,t,a){var r=this.renderer.context;void 0===a&&(a={});for(var n=0,i=Object.keys(e);n<i.length;n++){var s=i[n],o=this.createBuffer(s,r.ARRAY_BUFFER);o.data=new Float32Array(F(e[s])),o.addAttribute(s,{offset:0,size:3,type:r.FLOAT,stride:0}),this.buffers[s]=o}var c=this.createBuffer("@triangles",r.ELEMENT_ARRAY_BUFFER);c.data=new Uint16Array(F(t)),this.vertex_count=c.data.length,this.vertex_count>65536&&_.a.warn("Mesh '".concat(this.name,"' has too many vertices (").concat(this.vertex_count," > ").concat(65536,"). Expect unexpected issues.")),c.addAttribute("@triangles",{offset:0,size:3,type:r.UNSIGNED_INT,stride:0}),this.buffers["@triangles"]=c,this.apply()}},{key:"init",value:function(){}},{key:"deinit",value:function(){for(var e=0,t=Object.keys(this.buffers);e<t.length;e++){var a=t[e];this.buffers[a].deinit()}}},{key:"isReady",value:function(){return this.ready}},{key:"apply",value:function(){for(var e=0,t=Object.keys(this.buffers);e<t.length;e++){var a=t[e];this.buffers[a].apply()}this.ready=!0}},{key:"draw",value:function(e){var t=this.renderer.context;if(!(this.vertex_count<2)){for(var a=0,r=Object.keys(this.buffers);a<r.length;a++){var n=r[a];n.startsWith("@")||this.buffers[n].attachShader(e)}this.buffers["@triangles"].bind(),t.drawElements(t.TRIANGLES,this.vertex_count,t.UNSIGNED_SHORT,0)}}}]),e}(),Y=10497,q=33071,Z=9729,Q=9987,K=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e,r,n){var i;return Object(l.a)(this,a),n||(n={}),(i=t.call(this,r)).renderer=e,i.type=null,i.image=null,i.texture=null,i.parameters=Object(g.a)({min_filter:Q,mag_filter:Z,wrap:[Y,Y],anisotropy_level:0},n),i}return Object(h.a)(a,[{key:"isReady",value:function(){return this.isLoaded()}},{key:"init",value:function(){var e=this.renderer.context;this.texture=e.createTexture()}},{key:"setFromColorInit",value:function(e){this.type=e,this.setState(S),this.renderer.context.bindTexture(this.type,this.texture)}},{key:"setFromColor",value:function(e){this.setFromColorInit(U.TEXTURE_2D);var t=this.renderer.context,a=t.RGBA;x.e.scale(e,e,255);var r=new Uint8Array(e),n=this.getGLTextureType();t.bindTexture(n,this.texture),t.texImage2D(n,0,a,1,1,0,a,t.UNSIGNED_BYTE,r),this.setState(P)}},{key:"createCheckerData",value:function(e,t,a,r){x.e.scale(e,e,255),x.e.scale(t,t,255);for(var n=[],i=0;i<a*a;i++){var s=i%a,o=Math.floor(i/a);(Math.floor(s/(a/r))+Math.floor(o/(a/r)))%2===0?n.push(e):n.push(t)}return F(n)}},{key:"setCheckerFromColor",value:function(e,t,a,r){this.setFromColorInit(U.TEXTURE_2D);var n=this.renderer.context,i=n.RGBA,s=this.getGLTextureType();n.bindTexture(s,this.texture),n.texImage2D(s,0,i,1,1,0,i,n.UNSIGNED_BYTE,new Uint8Array(this.createCheckerData(e,t,a,r))),this.setState(P)}},{key:"setFromColorCubemap",value:function(e){this.setFromColorInit(U.TEXTURE_CUBE_MAP);var t=this.renderer.context;x.e.scale(e,e,255);var a=new Uint8Array(e);this.getGLTextureType();[t.TEXTURE_CUBE_MAP_POSITIVE_X,t.TEXTURE_CUBE_MAP_NEGATIVE_X,t.TEXTURE_CUBE_MAP_POSITIVE_Y,t.TEXTURE_CUBE_MAP_NEGATIVE_Y,t.TEXTURE_CUBE_MAP_POSITIVE_Z,t.TEXTURE_CUBE_MAP_NEGATIVE_Z].forEach((function(e,r){var n=t.RGB,i=t.UNSIGNED_BYTE;t.texImage2D(e,0,n,1,1,0,n,i,a)})),this.setState(P)}},{key:"setFromCheckerCubemap",value:function(e,t,a,r){this.setFromColorInit(U.TEXTURE_CUBE_MAP);var n=this.renderer.context,i=new Uint8Array(this.createCheckerData(e,t,a,r)),s=this.getGLTextureType();[n.TEXTURE_CUBE_MAP_POSITIVE_X,n.TEXTURE_CUBE_MAP_NEGATIVE_X,n.TEXTURE_CUBE_MAP_POSITIVE_Y,n.TEXTURE_CUBE_MAP_NEGATIVE_Y,n.TEXTURE_CUBE_MAP_POSITIVE_Z,n.TEXTURE_CUBE_MAP_NEGATIVE_Z].forEach((function(e,t){var r=n.RGBA,s=n.UNSIGNED_BYTE;n.texImage2D(e,0,r,a,a,0,r,s,i)})),n.generateMipmap(s),n.texParameteri(s,n.TEXTURE_WRAP_S,this.parameters.wrap[0]),n.texParameteri(s,n.TEXTURE_WRAP_T,this.parameters.wrap[1]),n.texParameteri(s,n.TEXTURE_MIN_FILTER,n.NEAREST),n.texParameteri(s,n.TEXTURE_MAG_FILTER,n.NEAREST),this.setState(P)}},{key:"getGLTextureType",value:function(){return this.type}},{key:"deinit",value:function(){this.renderer.context.deleteTexture(this.texture)}},{key:"load",value:function(e){if(null===this.type)return _.a.info("Fetching image '".concat(e,"' for texture '").concat(this.name,"'.")),this.type=U.TEXTURE_2D,this.setState(S),this.image=new Image,this.image.onload=this.handleImageLoad.bind(this),this.image.onerror=this.handleImageError.bind(this),this.image.src=e,this;_.a.warn("Texture '".concat(this.name,"' already has an image assigned, skipping download of '").concat(e,"'."))}},{key:"loadCubemap",value:function(e){if("string"!==typeof e&&_.a.warn("loadCubemap() must be called with a string URL (at the moment)"),null===this.type){for(var t=[],a=0;a<6;a++)t.push(e.replace("{id}",a.toString().padStart(4,"0")));return this.loadCubemapFacesFromURL(t),this}_.a.warn("Texture '".concat(this.name,"' already has an image assigned, skipping download of '").concat(e,"'."))}},{key:"loadCubemapFacesFromURL",value:function(e){var t=this;this.type=U.TEXTURE_CUBE_MAP,this.setState(S),this.images=[],this.images=e.map((function(e,a){_.a.info("Fetching image '".concat(e,"' for cubemap '").concat(t.name,"'."));var r=new Image;return r.onload=function(){t.handleCubemapImageLoad(a)},r.onerror=t.handleImageError.bind(t),r.src=e,{image:r,loaded:!1,index:a}}))}},{key:"setParameters",value:function(e){return this.parameters=Object(g.a)(Object(g.a)({},this.parameters),e),this.applyParameters(),this}},{key:"assignImage",value:function(){var e=this.renderer.context,t=this.getGLTextureType();e.bindTexture(t,this.texture),this.type===U.TEXTURE_CUBE_MAP?this.assignCubemap():this.assign2D(),e.generateMipmap(t),this.applyParameters()}},{key:"assign2D",value:function(){var e=this.renderer.context,t=this.getGLTextureType(),a=e.RGB,r=e.UNSIGNED_BYTE;e.texImage2D(t,0,a,a,r,this.image)}},{key:"assignCubemap",value:function(){_.a.info("Assigning image '".concat(this.name,"' to WebGL cubemap texture."));var e=this.renderer.context,t=[e.TEXTURE_CUBE_MAP_POSITIVE_X,e.TEXTURE_CUBE_MAP_NEGATIVE_X,e.TEXTURE_CUBE_MAP_POSITIVE_Y,e.TEXTURE_CUBE_MAP_NEGATIVE_Y,e.TEXTURE_CUBE_MAP_POSITIVE_Z,e.TEXTURE_CUBE_MAP_NEGATIVE_Z];this.images.forEach((function(a){var r=e.RGB,n=e.UNSIGNED_BYTE;e.texImage2D(t[a.index],0,r,r,n,a.image)}))}},{key:"applyParameters",value:function(){var e=this.renderer.context,t=this.getGLTextureType();e.bindTexture(t,this.texture),e.texParameteri(t,e.TEXTURE_WRAP_S,this.parameters.wrap[0]),e.texParameteri(t,e.TEXTURE_WRAP_T,this.parameters.wrap[1]),e.texParameteri(t,e.TEXTURE_MIN_FILTER,this.parameters.min_filter),e.texParameteri(t,e.TEXTURE_MAG_FILTER,this.parameters.mag_filter),this.parameters.anisotropy_level&&this.applyParameterAnisotropy()}},{key:"applyParameterAnisotropy",value:function(){var e=this.renderer.context,t=this.getGLTextureType(),a=this.renderer.getExtension("EXT_texture_filter_anisotropic");if(a){var r=Math.min(this.parameters.anisotropy_level,void 0===this.renderer.options.max_anisotropy_level?32:this.renderer.options.max_anisotropy_level,a.max);e.texParameterf(t,a.ext.TEXTURE_MAX_ANISOTROPY_EXT,Math.max(r,1))}}},{key:"bind",value:function(){this.applyParameters()}},{key:"handleImageLoad",value:function(){this.assignImage(),this.setState(P)}},{key:"handleCubemapImageLoad",value:function(e){this.images[e].loaded=!0;var t,a=Object(T.a)(this.images);try{for(a.s();!(t=a.n()).done;){if(!t.value.loaded)return}}catch(r){a.e(r)}finally{a.f()}this.state!==A&&(this.assignImage(),this.setState(P))}},{key:"handleImageError",value:function(e){_.a.warn("Image '".concat(e.target.src,"' could not be fetched."),e),this.setState(A)}}]),a}(O),J=0,$=1,ee=0,te=1,ae=2,re=0,ne=function(){function e(t,a){Object(l.a)(this,e),this.scene=t,this.shader_name=a,this.uniforms=new W(this.flagDirty.bind(this)),this.blend_mode=J,this.depth_mode=ae,this.index=re++}return Object(h.a)(e,[{key:"flagDirty",value:function(){this.scene.flagDirty()}},{key:"set",value:function(e,t){this.uniforms.set(e,t)}}]),e}(),ie=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e,r){var n;return Object(l.a)(this,a),(n=t.call(this,"@renderer")).can_move_backwards=!0,n.canvas=e,n.paused=!1,n.render_required=!1,n.options=Object(g.a)({max_anisotropy_level:16,scale:1},r||{}),n.context=null,n.size=[1,1],n.dpi=1,n._dirty=!1,n.active={shader:null,buffer:null,blend_mode:null,depth_mode:null},n.performance={vertex_count:0,draw_call_count:0,fps:0,frametime_samples:0,frametime_total:0,frame_start:0,current_frame:0},n.extensions={},n.shaders={},n.meshes={},n.textures=new M("@texture-loader"),n.scene=null,n.initDebounce=w()(n.init.bind(Object(u.a)(n)),150,!0),n.resizeDebounce=w()(n.resizeImmediate.bind(Object(u.a)(n)),50),n.terminate_rendering=!1,n.handleLoaderStateChange=n.handleLoaderStateChange.bind(Object(u.a)(n)),n.handleLoaderChildStateChange=n.handleLoaderChildStateChange.bind(Object(u.a)(n)),n}return Object(h.a)(a,[{key:"init",value:function(){var e=this;_.a.debug("Initializing WebGL renderer..."),this.setState(S);for(var t=["alpha","desynchronized","antialias","depth","failIfMajorPerformanceCaveat","powerPreference","premultipliedAlpha","preserveDrawingBuffer","stencil"],a={},r=0,n=Object.keys(this.options);r<n.length;r++){var i=n[r];i in t&&(a[i]=this.options[i])}try{this.context=this.canvas.getContext("webgl",Object(g.a)({alpha:!1},a))}catch(s){throw _.a.error("An error was thrown while creating WebGL 1 context!",s),new Error("webgl-context-create-error")}if(null===this.context)throw _.a.error("WebGL context is null!"),new Error("webgl-context-create-error");this.canvas.addEventListener("webglcontextlost",(function(t){t.preventDefault(),e.context=null,e.deinit(),e.initDebounce()}),!1),this.initExtensions(),this.initShaders(),this.initMeshes(),this.initTextures(),this.initCanvas(),this.create(),this.textures.on("statechange",this.handleLoaderStateChange),this.textures.on("childstatechange",this.handleLoaderChildStateChange),this.handleLoaderStateChange(),requestAnimationFrame(this.render.bind(this))}},{key:"handleLoaderStateChange",value:function(){this.setState(this.getCombinedState([this.textures])),this.isLoaded()&&_.a.info("All initial assets for this renderer are loaded.")}},{key:"handleLoaderChildStateChange",value:function(){this.flagDirty()}},{key:"create",value:function(){}},{key:"setOption",value:function(e,t){this.options[e]!==t&&(this.options[e]=t,this.flagDirty(),this.applyOptions())}},{key:"applyOptions",value:function(){this.resize(),this.applyTextureParameters()}},{key:"applyTextureParameters",value:function(){for(var e=0,t=Object.values(this.textures.getAllAssets());e<t.length;e++){t[e].applyParameters()}}},{key:"initExtensions",value:function(){var e=this.context,t=this.getExtension("EXT_texture_filter_anisotropic","MOZ_EXT_texture_filter_anisotropic","WEBKIT_EXT_texture_filter_anisotropic");t&&(t.max=e.getParameter(t.ext.MAX_TEXTURE_MAX_ANISOTROPY_EXT))}},{key:"getExtension",value:function(e){if(!(e in this.extensions)){var t=this.context;this.extensions[e]=null;for(var a=0;a<arguments.length;a++){var r=t.getExtension(arguments[a]);if(null!==r){this.extensions[e]={ext:r};break}}}return this.extensions[e]}},{key:"initShaders",value:function(){this.createShader("@fallback","\nattribute vec3 aPosition;\n//attribute vec3 aNormal;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uProjectionMatrix;\n\nvoid main() {\n  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(aPosition, 1.0);\n}\n","precision mediump float;\n\nvoid main() {\n  gl_FragColor = vec4(1.0, 0.0, 1.0, 1.0);\n}\n")}},{key:"initMeshes",value:function(){this.createMesh("@triangle").createMesh({aPosition:[[-.5,-.5,0],[0,.5,0],[.5,-.5,0]]},[[0,1,2]]),this.createMesh("@square").createMesh({aPosition:[[-.5,-.5,0],[-.5,.5,0],[.5,.5,0],[.5,-.5,0]]},[[0,1,2],[2,0,3]])}},{key:"initTextures",value:function(){this.createTexture("@fallback").setFromColor(x.e.fromValues(0,1,1,1)),this.createTexture("@fallback-cube").setFromCheckerCubemap(x.e.fromValues(0,1,1,1),x.e.fromValues(0,0,0,1),64,8)}},{key:"initCanvas",value:function(){this.resizeImmediate();var e=this.context;e.clearColor(0,.3,0,1),e.clearDepth(1),e.enable(e.DEPTH_TEST),e.depthFunc(e.LEQUAL),e.enable(e.CULL_FACE),e.cullFace(e.BACK)}},{key:"deinit",value:function(){_.a.debug("Deinitializing renderer...");for(var e=0,t=Object.keys(this.shaders);e<t.length;e++){var a=t[e];this.shaders[a].deinit()}this.shaders={};for(var r=0,n=Object.keys(this.meshes);r<n.length;r++){var i=n[r];this.meshes[i].deinit()}this.meshes={}}},{key:"createShader",value:function(e,t,a){e in this.shaders&&(_.a.warn("Duplicate shader '".concat(e,"' is being requested; deleting existing shader.")),this.shaders[e].deinit()),_.a.debug("Creating shader '".concat(e,"'..."));var r=new X(this,e,t,a);return r.init(),this.shaders[e]=r,r}},{key:"getShader",value:function(e){return e in this.shaders&&this.shaders[e].isReady()?this.shaders[e]:(_.a.warn("No such shader '".concat(e,"'")),this.shaders["@fallback"])}},{key:"createMesh",value:function(e){e in this.meshes&&(_.a.warn("Duplicate mesh '".concat(e,"' is being requested; deleting existing mesh.")),this.meshes[e].deinit()),_.a.debug("Creating mesh '".concat(e,"'..."));var t=new H(this,e);return this.meshes[e]=t,t}},{key:"getMesh",value:function(e){return e in this.meshes&&this.meshes[e].isReady()?this.meshes[e]:(_.a.warn("No such mesh '".concat(e,"'")),this.meshes["@triangle"])}},{key:"createTexture",value:function(e){e in this.textures&&(_.a.warn("Duplicate texture '".concat(e,"' is being requested; deleting existing texture.")),this.textures[e].deinit()),_.a.debug("Creating texture '".concat(e,"'..."));var t=new K(this,e);return t.init(),this.textures.addAsset(e,t),t}},{key:"getTexture",value:function(e){return this.textures.hasAsset(e)&&this.textures.getAsset(e).isReady()?this.textures.getAsset(e):this.textures.getAsset("@fallback")}},{key:"resizeImmediate",value:function(){this.size=x.c.fromValues(this.canvas.parentElement.clientWidth,this.canvas.parentElement.clientHeight),this.dpi=window.devicePixelRatio,this.canvas.style.width="100%",this.canvas.style.height="100%",x.c.scale(this.size,this.size,this.options.scale),this.canvas.width=this.size[0]*this.dpi,this.canvas.height=this.size[1]*this.dpi,this.flagDirty(),this.render_required=!0,_.a.debug("Resizing renderer to ".concat(this.size," @ ").concat(this.dpi,"x"))}},{key:"resize",value:function(){this.resizeDebounce()}},{key:"flagDirty",value:function(){this._dirty=!0}},{key:"setBlendMode",value:function(e){var t=this.context;if(this.active.blend_mode!==e)switch(this.active.blend_mode=e,e){case J:t.blendFunc(t.ONE,t.ZERO);break;case $:t.enable(t.BLEND),t.blendFunc(t.SRC_ALPHA,t.ONE);break;default:_.a.warn("Invalid blend mode '".concat(e,"'"))}}},{key:"setDepthMode",value:function(e){var t=this.context;if(this.active.depth_mode!==e)switch(this.active.depth_mode=e,e){case ee:t.disable(t.DEPTH_TEST),t.depthMask(!1);break;case te:t.enable(t.DEPTH_TEST),t.depthMask(!1);break;case ae:t.enable(t.DEPTH_TEST),t.depthMask(!0);break;default:_.a.warn("Invalid depth mode '".concat(e,"'"))}}},{key:"shouldRender",value:function(){return this._dirty||this.render_required||this.scene&&this.scene._dirty?!(this.paused&&!this.render_required)&&!(!this.isLoaded()&&this.performance.current_frame<=1):(this.performance.frame_start=-1,!1)}},{key:"render",value:function(){if(null===this.context||this.terminate_rendering)return!1;requestAnimationFrame(this.render.bind(this));try{if(null!==this.scene&&this.scene.update(this),!this.shouldRender())return!1;this._dirty=!1,this.render_required=!1;var e=this.context;this.setBlendMode(J),this.setDepthMode(ae),e.clear(e.COLOR_BUFFER_BIT|e.DEPTH_BUFFER_BIT),e.viewport(0,0,this.size[0]*this.dpi,this.size[1]*this.dpi),this.performance.vertex_count=0,this.performance.draw_call_count=0,null!==this.scene?this.scene.draw(this):_.a.warn("No scene to draw, skipping...");var t=Date.now()/1e3;return this.performance.frame_start>0&&(this.performance.frametime_total+=t-this.performance.frame_start,this.performance.frametime_samples+=1,this.performance.frametime_samples>8&&(this.performance.fps=this.performance.frametime_samples/this.performance.frametime_total,this.performance.frametime_total=0,this.performance.frametime_samples=0)),this.performance.frame_start=t,this.performance.current_frame+=1,!0}catch(a){throw this.terminate_rendering=!0,a}}}]),a}(O),se=function(){function e(){Object(l.a)(this,e),this.scene=null,this.order=he.AUTO}return Object(h.a)(e,[{key:"flagDirty",value:function(){this.scene?this.scene.flagDirty():_.a.warn("flagDirty() being called for SpatialData, but no scene is bound!")}},{key:"update",value:function(e,t){}},{key:"getRenderSort",value:function(e){return 0}}]),e}(),oe=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e,r){var n;return Object(l.a)(this,a),(n=t.call(this)).mesh_name=e,n.material=r,n.uniforms=new W(n.flagDirty.bind(Object(u.a)(n))),n}return Object(h.a)(a,[{key:"getMaterial",value:function(e){return this.material||(e?e.scene.fallback_material:null)}},{key:"getRenderSort",value:function(e){var t=0,a=function(e,t,a){return e>Math.pow(t)?(_.a.error("Cannot shift '".concat(a,"' for render sort order; would cause overflow within '").concat(t,"'")),0):Math.floor(a)<<e-t},r=this.getMaterial(e),n=e.scene.camera.getData(ce),i=Math.pow(Math.min(Math.max((-e.modelview_matrix[14]-n.near)/(n.far-n.near),0),1),.2)*Math.pow(2,15);return t|=a(31,8,this.order),e.order>=he.TRANSPARENT?(t|=a(24,15,i),t|=a(8,8,r.index)):(t|=a(24,8,r.index),t|=a(16,15,i)),t}},{key:"draw",value:function(e,t){var a=this.getMaterial(t),r=e.getMesh(this.mesh_name),n=e.getShader(this.material.shader_name);if(r)if(n){var i=Object(g.a)(Object(g.a)(Object(g.a)(Object(g.a)(Object(g.a)({},t.scene.uniforms.get()),a.uniforms.get()),t.scene.camera?t.scene.camera.getData(ce).uniforms.get():{}),t.uniforms.get()),this.uniforms.get());n.use(),n.setUniforms(i),e.performance.draw_call_count+=1,e.performance.vertex_count+=r.vertex_count,e.setBlendMode(a.blend_mode),e.setDepthMode(a.depth_mode),r.draw(n)}else _.a.warn("MeshInstance for '".concat(t.name,"' uses material '").concat(a.name,"' that uses non-existent shader '").concat(a.shader_name,"'"));else _.a.warn("MeshInstance for '".concat(t.name,"' points to non-existent mesh '").concat(this.mesh_name,"'"))}},{key:"set",value:function(e,t){this.uniforms.set(e,t)}}]),a}(se),ce=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e,r,n){var i;return Object(l.a)(this,a),(i=t.call(this)).fov=e,i.near=r,i.far=n,i.projection_matrix=x.a.create(),i.uniforms=new W(i.flagDirty.bind(Object(u.a)(i))),i}return Object(h.a)(a,[{key:"update",value:function(e,t){Object(y.a)(Object(b.a)(a.prototype),"update",this).call(this,e,t),this.uniforms.set("uViewMatrix",t.world_matrix_inverse),this.uniforms.set("uViewMatrix_i",t.world_matrix),x.a.perspective(this.projection_matrix,this.fov*(Math.PI/180),e.size[0]/e.size[1],this.near,this.far),this.uniforms.set("uProjectionMatrix",this.projection_matrix),this.uniforms.set("uCameraData",[this.near,this.far,0,0])}}]),a}(se),le=function(){function e(t,a){Object(l.a)(this,e),this.position=x.d.create(),this.rotation=x.b.create(),this.scale=x.d.fromValues(1,1,1),this.world_matrix=x.a.create(),this.world_matrix_inverse=x.a.create(),this.modelview_matrix=x.a.create(),this.scene=t,this.enabled=!0,this.name=a,this.parent=null,this.children=[],this.render_sort=0,this._data=null,this.uniforms=new W(this.flagDirty.bind(this))}return Object(h.a)(e,[{key:"flagDirty",value:function(){this.enabled&&(null===this.parent?this.scene.flagDirty():this.parent.flagDirty())}},{key:"update",value:function(e){if(this.enabled){this.callData("update",e,this),this.updateMatrices();var t,a=Object(T.a)(this.children);try{for(a.s();!(t=a.n()).done;){t.value.update(e)}}catch(r){a.e(r)}finally{a.f()}}}},{key:"updateRenderSort",value:function(){this._data&&(this.render_sort=this._data.getRenderSort(this))}},{key:"updateMatrices",value:function(){x.a.fromRotationTranslationScale(this.world_matrix,this.rotation,this.position,this.scale),null!==this.parent&&x.a.multiply(this.world_matrix,this.parent.world_matrix,this.world_matrix),null!==this.scene.camera&&x.a.multiply(this.modelview_matrix,this.scene.camera.world_matrix_inverse,this.world_matrix),x.a.invert(this.world_matrix_inverse,this.world_matrix)}},{key:"updatePost",value:function(e){if(this.enabled){this.updateMatrices(),this.updateRenderSort(),this.updateUniforms();var t,a=Object(T.a)(this.children);try{for(a.s();!(t=a.n()).done;){t.value.updatePost(e)}}catch(r){a.e(r)}finally{a.f()}}}},{key:"updateUniforms",value:function(){this.uniforms.set("uWorldMatrix",this.world_matrix),this.uniforms.set("uWorldMatrix_i",this.world_matrix_inverse),this.uniforms.set("uModelViewMatrix",this.modelview_matrix)}},{key:"getRenderables",value:function(){var e=[];this.hasDataFunction("draw")&&this.enabled&&e.push(this);var t,a=Object(T.a)(this.children);try{for(a.s();!(t=a.n()).done;){var r=t.value;e.push.apply(e,r.getRenderables())}}catch(n){a.e(n)}finally{a.f()}return e}},{key:"draw",value:function(e,t){if(this.enabled&&(this.callData("draw",e,this),t)){var a,r=Object(T.a)(this.children);try{for(r.s();!(a=r.n()).done;){a.value.draw(e,t)}}catch(n){r.e(n)}finally{r.f()}}}},{key:"setUniform",value:function(e,t){this.uniforms.set(e,t)}},{key:"setEnabled",value:function(e){this.enabled!==e&&(this.enabled=e,this.flagDirty())}},{key:"setData",value:function(e){e.scene&&e.scene!==this.scene&&_.a.warn("Object data for object '".concat(this.name,"' cannot be shared across different scenes; reassigning...")),e.scene=this.scene,this._data=e}},{key:"getData",value:function(e){return this._data,this._data}},{key:"callData",value:function(e){this._data&&e in this._data&&this._data[e].apply(this._data,Array.prototype.slice.call(arguments,1))}},{key:"hasDataFunction",value:function(e){if(this._data)return e in this._data}},{key:"add",value:function(e){_.a.debug("Adding spatial object '".concat(e.name,"' to parent '").concat(this.name,"'")),this.children.push(e),null!==e.parent&&e.parent.remove(e),e.parent=this,this.scene.flagDirty()}},{key:"remove",value:function(e){_.a.error("Not implemented yet")}}]),e}(),he={AUTO:0,OPAQUE:64,TRANSPARENT:128},ue=function(){function e(){Object(l.a)(this,e),this.root=new le(this,"@root"),this._dirty=!0,this.enabled=!0,this.fallback_material=new ne(this,"@fallback"),this.camera=null,this.uniforms=new W(this.flagDirty.bind(this))}return Object(h.a)(e,[{key:"setEnabled",value:function(e){this.enabled!==e&&(this.enabled=e,this.flagDirty())}},{key:"flagDirty",value:function(){this.enabled&&(this._dirty=!0)}},{key:"setCamera",value:function(e){e.scene===this?(this.camera=e,this.flagDirty()):_.a.warn("Cannot set camera '".concat(e.name,"' as default camera for scene it's not in!"))}},{key:"update",value:function(e){this.enabled&&(this.root.update(e),this.root.updatePost(e))}},{key:"batch",value:function(e){var t=this.root.getRenderables(e);return t.sort((function(e,t){return e.render_sort-t.render_sort})),t}},{key:"draw",value:function(e){if(this._dirty=!1,this.enabled)if(this.camera){var t,a=this.batch(e),r=Object(T.a)(a);try{for(r.s();!(t=r.n()).done;){t.value.draw(e,!1)}}catch(n){r.e(n)}finally{r.f()}}else _.a.warn("No camera set in scene, skipping render...")}},{key:"setUniform",value:function(e,t){this.uniforms.set(e,t)}}]),e}(),de="\n\nvec4 depthBufferLogVert(vec4 position, float factor, float camera_far_clip) {\n  position.z = (2.0 * log(factor * position.w + 1.0) / log(factor * camera_far_clip + 1.0) - 1.0) * position.w;\n\n  return position;\n}\n\n\nattribute vec3 aPosition;\nattribute vec3 aNormal;\n\nuniform mat4 uModelViewMatrix;\nuniform mat4 uWorldMatrix;\nuniform mat4 uProjectionMatrix;\nuniform vec4 uCameraData;\n\nvarying vec3 vPosition;\nvarying vec3 vScreenPosition;\nvarying vec3 vWorldPosition;\nvarying vec3 vWorldNormal;\nvarying vec3 vNormal;\n\nvoid main() {\n  vPosition = aPosition;\n  vNormal = aNormal;\n  vWorldPosition = (uWorldMatrix * vec4(aPosition, 1.0)).xyz;\n  vWorldNormal = normalize((uWorldMatrix * vec4(aNormal, 0.0)).xyz);\n  \n  gl_Position = uProjectionMatrix * uModelViewMatrix * vec4(aPosition, 1.0);\n\n  gl_Position = depthBufferLogVert(gl_Position, 1.0, uCameraData.y);\n\n  vScreenPosition = gl_Position.xyz / gl_Position.w;\n}\n",me=function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(){return Object(l.a)(this,a),t.apply(this,arguments)}return Object(h.a)(a,[{key:"init",value:function(){this.options.desynchronized=!0,Object(y.a)(Object(b.a)(a.prototype),"init",this).call(this)}},{key:"create",value:function(){var e=this;Object(y.a)(Object(b.a)(a.prototype),"create",this).call(this),this.scene=new ue,this.createTexture("stellar-body-earth-landinfo-cube").loadCubemap("static/stellar/bodies/earth/landinfo-{id}.jpg").setParameters({wrap:[q,q],anisotropy_level:16}),this.createTexture("stellar-body-earth-normal-cube").loadCubemap("static/stellar/bodies/earth/normal-{id}.jpg").setParameters({wrap:[q,q],anisotropy_level:16}),setTimeout((function(){e.color=e.createTexture("stellar-body-earth-color-cube"),e.color.loadCubemap("static/stellar/bodies/earth/color-{id}.jpg").setParameters({wrap:[q,q],anisotropy_level:16})}),5e3),this.createShader("earth",de,"precision highp float;\n\nuniform vec3 uLandColor;\nuniform vec3 uOceanColor;\nuniform vec3 uNightColor;\n\nuniform vec3 uStarPosition;\nuniform vec3 uStarColor;\n\nuniform samplerCube uLandinfoCube;\nuniform samplerCube uNormalCube;\nuniform samplerCube uColorCube;\n\nuniform mat4 uViewMatrix_i;\nuniform mat4 uWorldMatrix;\nuniform mat4 uWorldMatrix_i;\n\nvarying vec3 vPosition;\nvarying vec3 vScreenPosition;\nvarying vec3 vNormal;\nvarying vec3 vWorldPosition;\nvarying vec3 vWorldNormal;\nvarying vec3 vViewNormal;\n\nconst float PI = 3.141592653;\nconst float PI_2 = 6.28318530;\n\n\nvec3 getViewDirection() {\n  vec3 camera_position = uViewMatrix_i[3].xyz;\n  return normalize(vWorldPosition - camera_position);\n}\n\nvec3 getStarDirection() {\n  return normalize(uStarPosition - vWorldPosition);\n}\n\n\nvoid main() {\n  vec3 view_direction = getViewDirection();\n  vec3 star_direction = getStarDirection();\n  \n  vec3 t_normal = textureCube(uNormalCube, normalize(vNormal)).rgb * 2.0 - 1.0;\n  vec3 world_normal = normalize((uWorldMatrix * vec4(t_normal, 0.0)).xyz);\n  \n  //float blend = smoothstep(-0.01, 0.01, vScreenPosition.x);\n  \n  //gl_FragColor = vec4(mix(t_normal, world_normal, blend) * vec3(1.0, 1.0, 1.0), 1.0);\n  //return;\n  \n  //vec3 world_normal = normalize((uWorldMatrix * vec4(t_normal, 0.0)).xyz);\n  //vec3 world_normal = normalize((uWorldMatrix * vec4(aNormal, 0.0)).xyz);\n  \n  float star_exposure = min(dot(world_normal, star_direction), dot(vWorldNormal, star_direction));\n\n  //gl_FragColor = vec4(vec3(1.0) * star_exposure, 1.0);\n  //return;\n  vec3 star_brightness = pow(clamp(star_exposure, 0.0, 1.0), 1.0) * uStarColor;\n  star_brightness = star_brightness * 0.9 + 0.1;\n\n  float len = sqrt(pow(vPosition.x, 2.0) + pow(vPosition.z, 2.0));\n  vec3 reflection_direction = reflect(star_direction, vWorldNormal);\n\n  vec3 t_landinfo = textureCube(uLandinfoCube, normalize(vNormal)).rgb;\n  //vec3 t_color = texture2D(uTexture, coordinates).rgb;\n\n  vec3 t_color = textureCube(uColorCube, normalize(vNormal)).rgb;\n\n  float cloud_cover = t_landinfo.b;\n\n  vec3 land_color = uLandColor;\n\n  vec3 color = mix(uOceanColor, t_color, t_landinfo.r);\n\n  vec3 diffuse = color * star_brightness;\n  vec3 specular = vec3(0.5) * pow(clamp(dot(reflection_direction, view_direction), 0.0, 1.0), 12.0) * (1.0 - t_landinfo.r);\n\n  //t_landinfo = texture2D(uLandinfo, coordinates, pow(cloud_cover, 1.5) * 1.0).rgb;\n  \n  vec3 night = uNightColor * t_landinfo.g * clamp(pow(-star_exposure, 0.5), 0.0, 1.0);\n\n  color = diffuse + specular + night;\n\n  vec3 cloud_color = vec3(1.0) * pow(clamp(star_exposure, 0.0, 1.0), 0.6);//cloud_cover;\n\n  color = mix(color, vec3(0.0), t_landinfo.b);\n  \n  vec3 cloud_shadow_coord = normalize(vNormal + normalize((uWorldMatrix_i * vec4(star_direction, 0.0)).xyz) * -0.01);\n  float cloudshadow = textureCube(uLandinfoCube, cloud_shadow_coord).b;\n\n  color = mix(color, cloud_color, pow(cloudshadow, 0.75));\n  \n  gl_FragColor = vec4(color, 1.0);\n}\n"),this.createShader("star",de,"precision mediump float;\n\nuniform vec3 uColor;\n\nvarying vec3 vPosition;\nvarying vec3 vWorldPosition;\nvarying vec3 vWorldNormal;\n\nvoid main() {\n  float brightness = dot(vWorldNormal, vec3(0.0, 0.0, 1.0));\n  gl_FragColor = vec4(uColor * pow(brightness, 1.0), 1.0);\n}\n");this.createShader("atmosphere",de,"precision highp float;\n\nuniform vec3 uColor;\n\nuniform vec3 uStarPosition;\nuniform vec3 uStarColor;\n\n// X = planet radius; Y = atmosphere radius; Z = atmosphere power; W = mie strength\nuniform vec4 uAtmosphereParameters;\n\n// R = red scattering; G = green scattering; B = blue scattering; A = mie power\nuniform vec4 uAtmosphereRaleighScatter;\n\nuniform mat4 uWorldMatrix;\nuniform mat4 uWorldMatrix_i;\nuniform mat4 uViewMatrix;\nuniform mat4 uViewMatrix_i;\n\nvarying vec3 vPosition;\nvarying vec3 vWorldPosition;\nvarying vec3 vWorldNormal;\n\n// Returns a vec3 containing <distance to sphere surface>, <distance from entry (or camera) to exit>, angle-of-incidence\n// If the ray does not intersect the sphere, the X value is negative.\nvec4 raySphereDistance(vec3 point, vec3 dir, float radius) {\n  float radius2 = radius * radius;\n  \n  float tca = -dot(point, dir);\n\n  float d2 = dot(point, point) - (tca * tca);\n\n  float thc = sqrt(radius2 - d2);\n\n  float shadow = atan(sqrt(d2), thc) / 1.57079;\n  \n  float start = tca - thc;\n  float end = tca + thc;\n\n  if(d2 > (radius2)) {\n    return vec4(-1.0, -1.0, shadow, 0.0);\n  }\n\n  if(end < 0.0) {\n    return vec4(-1.0, -1.0, shadow, 0.0);\n  }\n\n  return vec4(start, end - max(start, 0.0), shadow, 0.0);\n}\n\n// Altitude is a floating-point value from 0..1 (where 0 is ground and 1 is sky.)\nfloat densityAtAltitude(float altitude) {\n  return exp(-clamp(altitude, 0.0, 1.0) * uAtmosphereParameters.z) * (1.0 - altitude);\n}\n\nfloat densityAtPoint(vec3 position) {\n  float atmosphere_height = uAtmosphereParameters.y - uAtmosphereParameters.x;\n  float altitude = (length(position) - uAtmosphereParameters.x) / atmosphere_height;\n\n  return densityAtAltitude(altitude);\n}\n\nconst int OPTICAL_DEPTH_STEPS = 5;\nfloat atmosphereOpticalDepth(vec3 position, vec3 direction, float ray_length) {\n  vec3 point = position;\n  float step_size = ray_length / float(OPTICAL_DEPTH_STEPS - 1);\n  float opticalDepth = 0.0;\n\n  for(int i=0; i<OPTICAL_DEPTH_STEPS; i++) {\n    point = position + direction * step_size * float(i);\n    opticalDepth += densityAtPoint(point) * step_size;\n  }\n\n  return opticalDepth;\n}\n\nconst int SCATTERING_STEPS = 8;\n\nvec3 atmosphereColor(vec3 position, vec3 direction, vec3 star_direction) {\n  float planet_radius = uAtmosphereParameters.x;\n  float atmosphere_radius = uAtmosphereParameters.y;\n\n  vec4 atmosphere_ray = raySphereDistance(position, direction, atmosphere_radius);\n\n  // The starting point of the ray (i.e. where it intersects with the atmosphere.)\n  vec3 ray_start = position - direction * -max(atmosphere_ray.x, 0.0);\n  float ray_length = max(atmosphere_ray.y, 0.0);\n  \n  vec4 planet_ray = raySphereDistance(position, direction, planet_radius);\n\n  if(planet_ray.y > 0.0) {\n    ray_length = (planet_ray.x - atmosphere_ray.x) * 0.9;\n  }\n\n  // The total atmosphere color at this point.\n  vec3 color = vec3(0.0);\n\n  float step_size = ray_length / float(SCATTERING_STEPS);\n  \n  for(int i=0; i<=SCATTERING_STEPS; i++) {\n    // The point in the atmosphere, in model space.\n    vec3 point = ray_start + direction * step_size * float(i);\n\n    vec4 star_ray = raySphereDistance(point, star_direction, atmosphere_radius);\n    // The distance through the atmosphere to the sun.\n    float star_distance = max(star_ray.y, 0.0);\n\n    // Cast a ray against the planet towards the sun.\n    //planet_ray = raySphereDistance(point, star_direction, planet_radius);\n\n    // How much of the sun is hitting this sample, from 0..1.\n    float star_exposure = 1.0;\n\n    // If the planet is in the way, calculate the smooth shadow.\n    /*\n    if(planet_ray.y > 0.0) {\n      star_exposure = smoothstep(0.5, 1.0, planet_ray.z);\n    }\n*/\n\n    // The optical depth (= approximate density) of the atmosphere along the ray towards the star.\n    float star_ray_optical_depth = atmosphereOpticalDepth(point, star_direction, star_distance);\n    float view_ray_optical_depth = atmosphereOpticalDepth(point, -direction, step_size);\n\n    // Mie scattering. Essentially a power curve when we're between the viewer and the sun.\n    float mie = uAtmosphereParameters.w * pow(max(dot(star_direction, direction), 0.0), uAtmosphereRaleighScatter.w);\n    \n    vec3 transmittance = exp(-(star_ray_optical_depth + view_ray_optical_depth) * uAtmosphereRaleighScatter.rgb) * star_exposure * uStarColor;\n\n    color += densityAtPoint(point) * transmittance * uAtmosphereRaleighScatter.rgb * step_size;\n    color += mie * densityAtPoint(point) * transmittance * step_size;\n  }\n\n  return color;\n}\n\nvoid main() {\n  // The direction of the star, in world space.\n  //vec3 star_direction = normalize(vWorldPosition - uStarPosition);\n  \n  //vec3 camera_position = uViewMatrix_i[3].xyz;\n  //vec3 view_direction = normalize(vWorldPosition - camera_position);\n  \n  vec3 star_direction = normalize((uWorldMatrix_i * vec4(uStarPosition - vWorldPosition, 0.0)).xyz);\n  \n  vec3 camera_position = (uWorldMatrix_i * vec4(uViewMatrix_i[3].xyz, 1.0)).xyz;\n  vec3 view_direction = normalize((uWorldMatrix_i * vec4(vWorldPosition, 1.0)).xyz - camera_position);\n  //vec3 view_direction = normalize((uWorldMatrix_i * vec4(vWorldPosition - camera_position, 0.0)).xyz);\n  \n  gl_FragColor = vec4(atmosphereColor(camera_position, view_direction, star_direction), 1.0);\n}\n");this.scene.uniforms.set("uColor",x.d.fromValues(1,1,1)),this.createQuadspheres(),this.createPlanet(),this.createCamera(),this.options=Object(g.a)(Object(g.a)({},this.options),{},{max_anisotropy_level:16,display_atmospheres:!0})}},{key:"createPlanet",value:function(){var e=new ne(this.scene,"earth"),t=new le(this.scene,"earth");t.setData(new oe("quadsphere",e));t.scale=x.d.fromValues(12742e3,12742e3,12742e3),e.set("uOceanColor",x.d.fromValues(.02,.17,.3)),e.set("uNightColor",x.d.fromValues(.8,.55,.4)),e.set("uNormalCube","stellar-body-earth-normal-cube"),e.set("uLandinfoCube","stellar-body-earth-landinfo-cube"),e.set("uColorCube","stellar-body-earth-color-cube"),this.scene.root.add(t),this.spinny=new le(this.scene,"spinny"),t.add(this.spinny);var a=new ne(this.scene,"atmosphere");a.blend_mode=$,a.depth_mode=te;var r=new le(this.scene,"atmosphere"),n=new oe("atmosphere",a);r.setData(n),n.order=he.TRANSPARENT;r.scale=x.d.fromValues(1.1,1.1,1.1),r.setUniform("uAtmosphereParameters",x.e.fromValues(1/1.1/2,.5,20,150));var i=x.e.fromValues(10,20,40);x.e.scale(i,i,1/4),x.e.scale(i,i,7),i[3]=10,r.setUniform("uAtmosphereRaleighScatter",i),this.atmosphere=r,t.add(r),this.earth=t;for(var s=0;s<0;s++){var o=new le(this.scene,"mesh-".concat(s));o.setData(new oe("quadsphere",new ne(this.scene,"body"))),o.setUniform("uColor",x.d.fromValues(1,1,1));var c=s/0*Math.PI*2;o.position=x.d.fromValues(1*Math.sin(c),0,1*Math.cos(c)),o.scale=x.d.fromValues(.1,.1,.1),this.spinny.add(o)}}},{key:"createCamera",value:function(){this.camera=new le(this.scene,"camera"),this.camera.setData(new ce(60,1,75e11)),this.camera.position=x.d.fromValues(0,0,1.2*this.earth.scale[0]),this.scene.root.add(this.camera),this.scene.setCamera(this.camera),this.context.clearColor(0,0,0,1)}},{key:"createQuadspheres",value:function(){this.createQuadsphere("quadsphere",32),this.createQuadsphere("atmosphere",8)}},{key:"createQuadsphere",value:function(e,t,a){void 0===a&&(a=!1);var r=1;a&&(r=-1),t+=2;var n=this.createMesh(e),i={position:[],normal:[],_triangles:[]},s=function(e){for(var a={position:[],_triangles:[]},n=0;n<t;n++)for(var i=0;i<t;i++){var s=n/t-.5,o=(i/t-.5)*r,c=(n+1)/t-.5,l=((i+1)/t-.5)*r;a.position.push(e(s,o)),a.position.push(e(s,l)),a.position.push(e(c,l)),a.position.push(e(c,o));var h=a.position.length-4;a._triangles.push([h+2,h+1,h+0]),a._triangles.push([h+2,h+0,h+3])}return{position:a.position,_triangles:a._triangles.flat()}},o=s((function(e,t){return[.5,e,t]})),c=s((function(e,t){return[-.5,-e,t]})),l=s((function(e,t){return[-e,.5,t]})),h=s((function(e,t){return[e,-.5,t]})),u=s((function(e,t){return[e,t,.5]})),d=s((function(e,t){return[-e,t,-.5]})),m=function(e,t){e._triangles.push.apply(e._triangles,t._triangles.map((function(t){return e.position.length+t})));for(var a=0,r=Object.keys(t);a<r.length;a++){var n=r[a];"_triangles"!==n&&e[n].push.apply(e[n],t[n])}return e};i=m(i,o),i=m(i,c),i=m(i,l),i=m(i,h),i=m(i,u),(i=m(i,d)).position.forEach((function(e,t){x.d.normalize(i.position[t],i.position[t]),x.d.scale(i.position[t],i.position[t],.5)})),i.normal=i.position.map((function(e,t){var r=x.d.create();return x.d.normalize(r,e),a&&x.d.scale(r,r,-1),r})),n.createMesh({aPosition:i.position,aNormal:i.normal},i._triangles)}},{key:"render",value:function(){var e=this,t=Date.now()/100;this.atmosphere.setEnabled(this.options.display_atmospheres);this.scene.scale=x.d.fromValues(1,1,1),this.scene.setUniform("uStarPosition",x.d.fromValues(1e8*Math.sin(t/10),2e7,1e8*Math.cos(t/10))),this.scene.setUniform("uStarColor",x.d.fromValues(1,.95,.9)),x.b.fromEuler(this.earth.rotation,0,.5*t,0),this.paused=this.options.paused,Object(y.a)(Object(b.a)(a.prototype),"render",this).call(this)&&this.viewer.setState((function(t){return{stats_fps:e.performance.fps,stats_vertex_count:e.performance.vertex_count,stats_draw_call_count:e.performance.draw_call_count,stats_frame_count:e.performance.current_frame}})),this.viewer.setState((function(t){return{loading:e.isLoading()}}))}}]),a}(ie);a(36);var fe=function(e){return n.a.createElement("div",{className:"EmptyState ".concat(e.variant?"App--theme-".concat(e.variant):"")},n.a.createElement("div",{className:"box"},n.a.createElement("h1",null,e.title),n.a.createElement("h2",{className:"message"},e.message)))},pe=(a(37),function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){var r;return Object(l.a)(this,a),(r=t.call(this,e)).state={checked:e.checked},r.handleClick=r.handleClick.bind(Object(u.a)(r)),r}return Object(h.a)(a,[{key:"handleClick",value:function(){this.setState((function(e){return{checked:!e.checked}})),"onChange"in this.props&&this.props.onChange(!this.state.checked,this)}},{key:"render",value:function(){return n.a.createElement("span",{className:"Switch ".concat(this.props.checked?"Switch--checked":""),onClick:this.handleClick},n.a.createElement("span",{className:"Switch__label"},this.props.label),n.a.createElement("span",{className:"Switch__element"}))}}]),a}(n.a.Component)),ve=a(20),_e=a.n(ve);a(38);var ge=function(e){var t=void 0===e.visible||e.visible,a=void 0===e.angle?null:e.angle,r=e.size||32;e.step&&(a=90*e.step/(e.stepSize||22.5));var i={};return a&&(i={transform:"rotate(".concat(a%360,"deg)")}),n.a.createElement("div",{className:"CircularProgress ".concat(a?"":"CircularProgress--spinning"," ").concat(t?"":"CircularProgress--hidden"),style:Object(g.a)({width:"".concat(r,"px"),height:"".concat(r,"px")},i),dangerouslySetInnerHTML:{__html:_e.a}})},ye=(a(39),function(e){Object(d.a)(a,e);var t=Object(m.a)(a);function a(e){var r;return Object(l.a)(this,a),(r=t.call(this,e)).state={loaded:!1,paused:!1,loading:!0,use_anisotropy:!0,display_stats:!0,display_atmospheres:!0,login:"",errorMessage:null,stats_fps:0,stats_vertex_count:0,stats_draw_call_count:0,stats_frame_count:0},r.handleRendererStateChanged=r.handleRendererStateChanged.bind(Object(u.a)(r)),r.handleWindowResize=r.handleWindowResize.bind(Object(u.a)(r)),r.canvas=n.a.createRef(),r.renderer=null,r}return Object(h.a)(a,[{key:"componentDidMount",value:function(){this.renderer=new me(this.canvas.current),this.initRenderer(),window.addEventListener("resize",this.handleWindowResize)}},{key:"componentWillUnmount",value:function(){window.removeEventListener("resize",this.handleWindowResize),this.deinitRenderer()}},{key:"handleWindowResize",value:function(){this.renderer.resize()}},{key:"handleRendererStateChanged",value:function(e){this.renderer.isLoaded()&&this.setState((function(e,t){return{loaded:!0}}))}},{key:"initRenderer",value:function(){try{this.renderer.on("statechange",this.handleRendererStateChanged),this.renderer.init(),this.renderer.viewer=this}catch(e){return _.a.error("Error while creating WebGL context: ",e),void this.setState((function(t,a){return{errorMessage:"We couldn't initialize WebGL. It could be you; it could be us.'".concat(e.message,"'")}}))}}},{key:"deinitRenderer",value:function(){this.renderer.deinit()}},{key:"createSwitchHandler",value:function(e){var t=this;return function(a){t.setState((function(t){return Object(c.a)({},e,a)}))}}},{key:"render",value:function(){var e=null;return e=this.state.errorMessage?n.a.createElement(fe,{variant:"dark",title:"Something went wrong",message:this.state.errorMessage}):n.a.createElement("div",{className:"OrreryViewer__loading"},n.a.createElement(ge,{size:64})),this.renderer&&(this.renderer.setOption("display_atmospheres",this.state.display_atmospheres),this.renderer.setOption("max_anisotropy_level",this.state.use_anisotropy?16:0),this.renderer.setOption("paused",this.state.paused)),n.a.createElement("section",{className:"OrreryViewer ".concat(this.state.loaded?"OrreryViewer--loaded":"")},n.a.createElement("canvas",{ref:this.canvas}),e,n.a.createElement("div",{className:"OrreryViewer__info"},n.a.createElement(ge,{visible:this.state.loading,size:24})),n.a.createElement("div",{className:"OrreryViewer__options App--theme-light"},n.a.createElement(pe,{label:"Pause Renderer",checked:this.state.paused,onChange:this.createSwitchHandler("paused")}),n.a.createElement(pe,{label:"Use Anisotropy",checked:this.state.use_anisotropy,onChange:this.createSwitchHandler("use_anisotropy")}),n.a.createElement(pe,{label:"Planet Atmospheres",checked:this.state.display_atmospheres,onChange:this.createSwitchHandler("display_atmospheres")}),n.a.createElement(pe,{label:"Show Stats",checked:this.state.display_stats,onChange:this.createSwitchHandler("display_stats")}),n.a.createElement(p.a,{duration:150,height:this.state.display_stats?"auto":0},n.a.createElement("ul",{className:"stats"},n.a.createElement("li",null,this.state.stats_fps.toFixed(1)," fps"),n.a.createElement("li",null,this.state.stats_draw_call_count," draw calls"),n.a.createElement("li",null,this.state.stats_vertex_count," vertices"),n.a.createElement("li",null,this.state.stats_frame_count," frames"),n.a.createElement("li",{className:"OrreryViewer__progress"},n.a.createElement("span",null,"Render"),n.a.createElement(ge,{step:this.state.stats_frame_count}))))))}}]),a}(n.a.Component));var be=function(){return n.a.createElement("main",{className:"App"},n.a.createElement(o,null),n.a.createElement(ye,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));_.a.useDefaults(),_.a.setLevel(_.a.TRACE);var xe=_.a.createDefaultHandler();_.a.setHandler((function(e,t){xe(e,t),function(e,t){t.level.value,_.a.DEBUG.value}(0,t)})),s.a.render(n.a.createElement(n.a.StrictMode,null,n.a.createElement(be,null)),document.getElementById("react-root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(e){e.unregister()})).catch((function(e){console.error(e.message)}))}},[[25,1,2]]]);
//# sourceMappingURL=main.326efe5f.chunk.js.map